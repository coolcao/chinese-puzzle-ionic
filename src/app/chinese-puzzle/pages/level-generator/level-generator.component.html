<div
  class="flex h-screen flex-col bg-wood-lighter transition-colors duration-300 dark:bg-dark-wood-lighter"
>
  <!-- 头部 -->
  <app-game-header
    titleTranslationKey="levelGeneratorPage.title"
    [showBackButton]="true"
    maxWidth="max-w-6xl"
    (backClick)="goHome()"
  ></app-game-header>

  <!-- 主要内容 -->
  <main
    class="flex-1 overflow-hidden bg-wood-light/50 dark:bg-dark-wood-dark/20"
  >
    <div class="h-full overflow-y-auto px-6 py-8">
      <div class="mx-auto max-w-6xl">
        <!-- 关卡信息 -->
        <div
          class="mb-8 rounded-2xl border-2 border-wood-border bg-wood-light p-6 shadow-lg dark:border-dark-wood-border dark:bg-dark-wood"
        >
          <h2
            class="mb-4 text-xl font-bold text-wood-text dark:text-wood-lighter"
          >
            {{ "levelGeneratorPage.levelInformation" | translate }}
          </h2>
          <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
            <div>
              <label
                class="mb-2 block text-sm font-medium text-wood-text dark:text-wood-lighter"
                >{{ "levelGeneratorPage.levelName" | translate }}</label
              >
              <input
                [(ngModel)]="levelName"
                type="text"
                class="w-full rounded-lg border border-wood-border bg-wood-lighter px-4 py-2 text-wood-text shadow-inner dark:bg-dark-wood-lighter dark:text-wood-lighter"
                placeholder="{{
                  'levelGeneratorPage.enterLevelName' | translate
                }}"
              />
            </div>
            <div>
              <label
                class="mb-2 block text-sm font-medium text-wood-text dark:text-wood-lighter"
                >{{ "levelGeneratorPage.levelDifficulty" | translate }}</label
              >
              <select
                [(ngModel)]="levelDifficulty"
                class="w-full rounded-lg border border-wood-border bg-wood-lighter px-4 py-2 text-wood-text shadow-inner dark:bg-dark-wood-lighter dark:text-wood-lighter"
              >
                <option value="beginner">
                  {{ "levelGeneratorPage.beginner" | translate }}
                </option>
                <option value="intermediate">
                  {{ "levelGeneratorPage.intermediate" | translate }}
                </option>
                <option value="advanced">
                  {{ "levelGeneratorPage.advanced" | translate }}
                </option>
              </select>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">
          <!-- 棋子模板 -->
          <div class="lg:col-span-1">
            <div
              class="mb-8 rounded-2xl border-2 border-wood-border bg-wood-light p-6 shadow-lg dark:border-dark-wood-border dark:bg-dark-wood"
            >
              <h2
                class="mb-4 text-xl font-bold text-wood-text dark:text-wood-lighter"
              >
                {{ "levelGeneratorPage.pieceTemplates" | translate }}
              </h2>
              <div class="grid grid-cols-2 gap-4">
                <div
                  *ngFor="let stockItem of pieceStock"
                  [draggable]="stockItem.count > 0"
                  (dragstart)="
                    stockItem.count > 0 &&
                      onTemplateDragStart($event, stockItem.template)
                  "
                  (dragend)="onTemplateDragEnd($event)"
                  class="relative flex flex-col items-center rounded-xl border-2 border-wood-border bg-wood-lighter p-4 transition-opacity dark:border-dark-wood-border dark:bg-dark-wood-light"
                  [ngClass]="{
                    'cursor-pointer hover:-translate-y-0.5 hover:shadow-lg':
                      stockItem.count > 0,
                    'cursor-not-allowed opacity-40': stockItem.count === 0,
                  }"
                >
                  <div
                    *ngIf="stockItem.template.name === 'zu'"
                    class="absolute -right-2 -top-2 flex h-5 w-5 items-center justify-center rounded-full bg-blue-500 text-xs text-white shadow-md"
                  >
                    {{ stockItem.count }}
                  </div>

                  <div
                    class="mb-2 flex items-center justify-center rounded-md border border-yellow-900 bg-cover bg-center text-lg font-medium text-[#6b4f27] shadow-md"
                    [ngStyle]="{
                      'background-image': 'url(/assets/img/wood-pattern.png)',
                      width: stockItem.template.width * 30 + 'px',
                      height: stockItem.template.height * 30 + 'px',
                    }"
                  >
                    <div
                      class="h-full w-full rounded-md border-[2px] border-solid border-[#b8864b] bg-cover bg-center"
                      [ngStyle]="{
                        'background-image':
                          'url(' + stockItem.template.img + ')',
                        'background-size': 'contain',
                        'background-repeat': 'no-repeat',
                        'background-position': 'center',
                      }"
                    ></div>
                  </div>
                  <span
                    class="text-sm font-medium text-wood-text dark:text-wood-lighter"
                    >{{ stockItem.template.name }}</span
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- 棋盘区域 -->
          <div class="lg:col-span-2">
            <div
              class="mb-8 rounded-2xl border-2 border-wood-border bg-wood-light p-6 shadow-lg dark:border-dark-wood-border dark:bg-dark-wood"
            >
              <h2
                class="mb-4 text-xl font-bold text-wood-text dark:text-wood-lighter"
              >
                {{ "levelGeneratorPage.gameBoard" | translate }}
              </h2>
              <div class="flex flex-col items-center">
                <!-- Canvas 棋盘 -->
                <canvas
                  #editorCanvas
                  (mousedown)="onMouseDown($event)"
                  (mousemove)="onMouseMove($event)"
                  (mouseup)="onMouseUp($event)"
                  (mouseleave)="onMouseLeave($event)"
                  (dragover)="onCanvasDragOver($event)"
                  (dragleave)="onCanvasDragLeave($event)"
                  (drop)="onCanvasDrop($event)"
                  class="mb-6 cursor-grab rounded-md border-4 border-b-0 border-solid border-wood-darker active:cursor-grabbing"
                >
                </canvas>

                <!-- 操作按钮 -->
                <div class="flex flex-wrap justify-center gap-4">
                  <button
                    (click)="validateData()"
                    appClickSound
                    [disabled]="isAnimating"
                    class="flex transform items-center gap-2 rounded-xl border-2 border-wood-border bg-wood px-6 py-3 font-bold text-wood-text shadow-lg transition duration-300 hover:bg-wood-hover active:scale-95 disabled:cursor-not-allowed disabled:opacity-50 dark:border-dark-wood-border dark:bg-dark-wood dark:text-wood-lighter dark:hover:bg-dark-wood-hover"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                    {{ "levelGeneratorPage.validateData" | translate }}
                  </button>
                  <button
                    *ngIf="solutionPath && !isAnimating"
                    (click)="animateSolution()"
                    appClickSound
                    class="flex transform items-center gap-2 rounded-xl border-2 border-blue-800 bg-blue-600 px-6 py-3 font-bold text-white shadow-lg transition duration-300 hover:bg-blue-700 active:scale-95"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                    {{ "levelGeneratorPage.demonstrateSolution" | translate }}
                  </button>
                  <button
                    (click)="generateAndCopy()"
                    appClickSound
                    [disabled]="isAnimating"
                    class="flex transform items-center gap-2 rounded-xl border-2 border-green-800 bg-green-600 px-6 py-3 font-bold text-white shadow-lg transition duration-300 hover:bg-green-700 active:scale-95 disabled:cursor-not-allowed disabled:opacity-50"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                      />
                    </svg>
                    {{ "levelGeneratorPage.generateAndCopy" | translate }}
                  </button>
                  <button
                    (click)="resetBoard()"
                    appClickSound
                    [disabled]="isAnimating"
                    class="flex transform items-center gap-2 rounded-xl border-2 border-red-700 bg-red-500 px-6 py-3 font-bold text-white shadow-lg transition duration-300 hover:bg-red-600 active:scale-95 disabled:cursor-not-allowed disabled:opacity-50"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                      />
                    </svg>
                    {{ "levelGeneratorPage.resetBoard" | translate }}
                  </button>
                </div>

                <!-- 提示信息 -->
                <div
                  *ngIf="message"
                  class="mt-4 rounded-lg border px-4 py-2 transition-colors duration-300"
                  [ngClass]="{
                    'border-blue-200 bg-blue-50 text-blue-800 dark:border-blue-700 dark:bg-blue-900/20 dark:text-blue-200':
                      messageType === 'info',
                    'border-green-200 bg-green-50 text-green-800 dark:border-green-700 dark:bg-green-900/20 dark:text-green-200':
                      messageType === 'success',
                    'border-red-200 bg-red-50 text-red-800 dark:border-red-700 dark:bg-red-900/20 dark:text-red-200':
                      messageType === 'error',
                  }"
                >
                  {{ message }}
                </div>

                <!-- 动画控制按钮（只在动画进行时显示，放在提示信息下方） -->
                <div *ngIf="isAnimating" class="mt-4 flex justify-center gap-3">
                  <button
                    (click)="pauseAnimation()"
                    appClickSound
                    class="flex transform items-center gap-2 rounded-lg border border-orange-600 bg-orange-500 px-5 py-2 font-medium text-white shadow-md transition duration-300 hover:bg-orange-600 active:scale-95"
                  >
                    <svg
                      *ngIf="!animationPaused"
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                    <svg
                      *ngIf="animationPaused"
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                    @if (animationPaused) {
                      {{ "levelGeneratorPage.resume" | translate }}
                    } @else {
                      {{ "levelGeneratorPage.pause" | translate }}
                    }
                  </button>
                  <button
                    (click)="stopAnimation()"
                    appClickSound
                    class="flex transform items-center gap-2 rounded-lg border border-red-600 bg-red-500 px-5 py-2 font-medium text-white shadow-md transition duration-300 hover:bg-red-600 active:scale-95"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 10h6v4H9z"
                      />
                    </svg>
                    {{ "levelGeneratorPage.stop" | translate }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

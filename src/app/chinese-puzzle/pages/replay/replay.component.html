<div
  class="h-screen w-screen select-none overflow-hidden bg-wood-lighter transition-colors duration-300 dark:bg-dark-wood-lighter"
>
  <!-- PC大屏左右布局 -->
  <div
    class="hidden h-full w-full flex-col bg-wood-light/50 dark:bg-dark-wood-dark/20 lg:flex"
  >
    <!-- 顶部header -->
    <app-game-header
      [titleTranslationKey]="'replay.title'"
      [showBackButton]="true"
      (backClick)="goBack()"
    ></app-game-header>

    <!-- 下面部分左右布局 -->
    <div class="mx-auto flex max-w-6xl flex-1">
      <!-- 左侧棋盘 -->
      <div class="flex flex-1 items-center justify-center p-6">
        <div class="flex max-w-2xl items-center justify-center">
          <canvas
            #replayCanvasPC
            class="replay-canvas rounded-md border-4 border-b-0 border-solid border-wood-darker"
          ></canvas>
        </div>
      </div>

      <!-- 右侧信息卡片 -->
      <div class="flex h-full w-full items-center justify-center">
        <div
          class="m-6 flex w-80 flex-col justify-between rounded-lg border-2 border-wood-border bg-wood-light shadow-lg dark:bg-dark-wood-lighter dark:text-wood"
          [style.height.px]="getCardHeight()"
        >
          <div class="rounded-t-lg border-b border-wood-border p-6">
            <h2
              class="mb-4 text-xl font-bold text-wood-text dark:text-wood-lighter"
            >
              {{ "replay.title" | translate }}
            </h2>

            <!-- 当前关卡信息 -->
            <div *ngIf="currentLevel" class="mb-6">
              <label
                class="mb-2 block text-sm font-medium text-wood-text dark:text-wood-lighter"
              >
                {{ "gameBoard.currentLevel" | translate }}
              </label>
              <div
                class="w-full rounded-lg border border-wood-border bg-wood/50 px-4 py-2 text-wood-text shadow-inner dark:bg-wood-dark/50 dark:text-wood-lighter"
              >
                <div class="font-semibold">
                  {{
                    currentLanguage === "zh"
                      ? currentLevel.name
                      : currentLevel.nameEn
                  }}
                  <span
                    class="ml-2 text-sm font-normal text-wood-text/70 dark:text-wood-lighter/70"
                  >
                    {{ "levels.difficulty." + currentLevel.difficulty | translate }}
                  </span>
                </div>
              </div>
            </div>

            <!-- 回放状态 -->
            <div class="space-y-4">
              <!-- 移除了步数和总步数显示，避免混淆 -->
            </div>
          </div>

          <!-- 控制面板 -->
          <div class="flex flex-col justify-end p-6">
            <h3
              class="mb-4 text-lg font-semibold text-wood-text dark:text-wood-lighter"
            >
              {{ "replay.controls" | translate }}
            </h3>

            <!-- 内容区域，保持空间 -->
            <div class="flex-1"></div>

            <!-- 底部控制区 -->
            <div class="space-y-4">
              <!-- 进度条 -->
              <div class="space-y-2">
                <div
                  class="flex items-center justify-between text-sm text-wood-text dark:text-wood-lighter"
                >
                  <span>{{ translate.instant("replay.currentStep") }}: {{ currentStep }}</span>
                  <span>{{ translate.instant("replay.totalSteps") }}: {{ totalSteps }}</span>
                </div>
                <input
                  type="range"
                  min="0"
                  [max]="totalSteps"
                  [(ngModel)]="currentStep"
                  (input)="onSliderChange($event)"
                  class="w-full"
                />
              </div>

              <!-- 播放控制按钮 -->
              <div class="flex justify-center space-x-4">
                <button
                  (click)="togglePlayPause()"
                  class="hover:bg-wood-main-hover h-16 w-16 rounded-full bg-wood-main p-3 text-white shadow-lg"
                  [disabled]="isCountingDown"
                >
                  <ion-icon
                    [name]="isPlaying ? 'pause' : 'play'"
                    class="text-2xl"
                  ></ion-icon>
                </button>
                <button
                  (click)="restartReplay()"
                  class="hover:bg-wood-main-hover h-16 w-16 rounded-full bg-wood-main p-3 text-white shadow-lg"
                >
                  <ion-icon name="refresh" class="text-2xl"></ion-icon>
                </button>
                <button
                  (click)="changePlaybackSpeed()"
                  class="hover:bg-wood-main-hover h-16 w-16 rounded-full bg-wood-main p-3 text-white shadow-lg"
                >
                  <span class="text-base font-bold">{{ getSpeedText() }}</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 移动端布局 -->
  <div class="flex h-full flex-col lg:hidden">
    <app-game-header
      [titleTranslationKey]="'replay.title'"
      [showBackButton]="true"
      (backClick)="goBack()"
    ></app-game-header>

    <!-- 关卡信息区域 - 移动端 -->
    <div
      *ngIf="currentLevel"
      class="border-b border-wood-border bg-wood-light/80 px-4 py-2 dark:border-dark-wood-border dark:bg-dark-wood-dark/80"
    >
      <div class="text-center">
        <h2
          class="text-base font-bold leading-tight text-wood-text dark:text-wood-light"
        >
          {{
            currentLanguage === "zh" ? currentLevel.name : currentLevel.nameEn
          }}
          <span
            class="ml-2 text-sm font-normal text-wood-text/70 dark:text-wood-light/70"
          >
            {{ "levels.difficulty." + currentLevel.difficulty | translate }}
          </span>
        </h2>
      </div>
    </div>

    <!-- 棋盘区域 -->
    <div
      class="flex flex-1 flex-col items-center justify-center bg-wood-light/50 px-4 dark:bg-dark-wood-darker/50"
    >
      <canvas
        #replayCanvasMobile
        class="h-auto w-full max-w-md rounded-md border-4 border-b-0 border-solid border-wood-darker"
      ></canvas>
    </div>

    <!-- 底部控制面板 -->
    <footer
      class="flex-shrink-0 border-t border-wood-border bg-wood-light px-2 py-2 dark:border-dark-wood-border dark:bg-dark-wood-dark sm:px-4 sm:py-3"
    >
      <div class="flex items-center justify-center space-x-2 sm:space-x-3">
        <button
          (click)="togglePlayPause()"
          class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-wood-main p-2 text-white shadow-lg sm:p-3"
          [disabled]="isCountingDown"
        >
          <ion-icon
            [name]="isPlaying ? 'pause' : 'play'"
            class="text-lg sm:text-xl"
          ></ion-icon>
        </button>
        <div class="flex w-full min-w-0 items-center space-x-1 sm:space-x-2">
          <span
            class="whitespace-nowrap text-xs text-wood-text dark:text-dark-wood-text sm:text-sm"
            >{{ currentStep }}</span
          >
          <input
            type="range"
            min="0"
            [max]="totalSteps"
            [(ngModel)]="currentStep"
            (input)="onSliderChange($event)"
            class="w-full min-w-0"
          />
          <span
            class="whitespace-nowrap text-xs text-wood-text dark:text-dark-wood-text sm:text-sm"
            >{{ totalSteps }}</span
          >
        </div>
        <button
          (click)="restartReplay()"
          class="h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-wood-main p-2 text-white shadow-lg sm:p-3"
        >
          <ion-icon name="refresh" class="text-lg sm:text-xl"></ion-icon>
        </button>
        <button
          (click)="changePlaybackSpeed()"
          class="h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-wood-main text-white shadow-lg sm:p-3"
        >
          <span class="text-xs font-bold sm:text-sm">{{ getSpeedText() }}</span>
        </button>
      </div>
    </footer>
  </div>

  <!-- 倒计时覆盖层 -->
  <div
    *ngIf="isCountingDown"
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"
  >
    <div
      class="flex h-32 w-32 items-center justify-center rounded-full bg-black/60 shadow-2xl backdrop-blur-sm dark:bg-gray-800/90"
    >
      <div class="text-6xl font-bold text-wood-main dark:text-wood-light">
        {{ countdownValue }}
      </div>
    </div>
  </div>
</div>

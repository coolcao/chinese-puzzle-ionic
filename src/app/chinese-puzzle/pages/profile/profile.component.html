<div
  class="flex h-screen flex-col bg-wood-lighter transition-colors duration-300 dark:bg-dark-wood-lighter"
>
  <!-- 顶部导航栏 -->
  <header
    class="border-b border-wood-border bg-wood-light dark:border-dark-wood-border dark:bg-dark-wood"
  >
    <div class="mx-auto max-w-6xl">
      <div class="flex items-center justify-between px-6 py-4">
      <!-- 返回按钮 -->
      <button
        (click)="goBack()"
        appClickSound
        class="flex items-center space-x-2 rounded-lg p-2 text-wood-text hover:bg-wood-lighter dark:text-wood-lighter dark:hover:bg-dark-wood-darker"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
      </button>

      <!-- 标题 -->
      <h1 class="text-xl font-bold text-wood-text dark:text-wood-lighter">
        {{ "myProfile.title" | translate }}
      </h1>

      <!-- 右侧按钮组 -->
      <div class="flex items-center space-x-2">
        <!-- 刷新按钮 -->
        <button
          (click)="refreshData()"
          appClickSound
          class="flex items-center space-x-2 rounded-lg p-2 text-wood-text hover:bg-wood-lighter dark:text-wood-lighter dark:hover:bg-dark-wood-darker"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            />
          </svg>
        </button>
      </div>
      </div>
    </div>
  </header>

  <!-- 主要内容区域 -->
  <div class="flex-1 overflow-hidden">
    <main class="h-full overflow-y-auto px-3 py-6">
      <div class="mx-auto max-w-6xl">
      <!-- 加载状态 -->
      <div *ngIf="isLoading()" class="flex items-center justify-center py-20">
        <div class="text-center">
          <div
            class="mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-4 border-wood-border border-t-wood-text dark:border-dark-wood-border dark:border-t-wood-lighter"
          ></div>
          <p class="text-wood-text dark:text-wood-lighter">
            {{ "myProfile.loading" | translate }}
          </p>
        </div>
      </div>

      <!-- 数据展示区域 -->
      <div *ngIf="!isLoading() && gameStats()" class="animate-fadeIn space-y-6">
        <!-- 游戏统计卡片 -->
        <div
          class="rounded-2xl border border-wood-border bg-wood-light p-6 shadow-lg dark:border-dark-wood-border dark:bg-dark-wood"
        >
          <h2
            class="mb-4 text-xl font-bold text-wood-text dark:text-wood-lighter"
          >
            {{ "myProfile.gameStatistics" | translate }}
          </h2>

          <div class="grid grid-cols-2 gap-4 md:grid-cols-4">
            <!-- 完成关卡数 -->
            <div
              class="rounded-xl bg-wood-lighter p-4 text-center dark:bg-dark-wood-light"
            >
              <p
                class="text-2xl font-bold tabular-nums tracking-tighter text-stone-700 dark:text-stone-300"
              >
                {{ gameStats()?.levelsCompleted || 0 }}
              </p>
              <p class="text-sm text-stone-700 dark:text-stone-300">
                {{ "myProfile.completedLevels" | translate }}
              </p>
            </div>

            <!-- 总游戏次数 -->
            <div
              class="rounded-xl bg-wood-lighter p-4 text-center dark:bg-dark-wood-light"
            >
              <p
                class="text-2xl font-bold tabular-nums tracking-tighter text-stone-700 dark:text-stone-300"
              >
                {{ gameStats()?.totalGames || 0 }}
              </p>
              <p class="text-sm text-stone-700 dark:text-stone-300">
                {{ "myProfile.totalGames" | translate }}
              </p>
            </div>

            <!-- 完美通关次数 -->
            <div
              class="rounded-xl bg-wood-lighter p-4 text-center dark:bg-dark-wood-light"
            >
              <p
                class="text-2xl font-bold tabular-nums tracking-tighter text-stone-700 dark:text-stone-300"
              >
                {{ gameStats()?.perfectCompletions || 0 }}
              </p>
              <p class="text-sm text-stone-700 dark:text-stone-300">
                {{ "myProfile.perfectCompletions" | translate }}
              </p>
            </div>

            <!-- 当前连续天数 -->
            <div
              class="rounded-xl bg-wood-lighter p-4 text-center dark:bg-dark-wood-light"
            >
              <p
                class="text-2xl font-bold tabular-nums tracking-tighter text-stone-700 dark:text-stone-300"
              >
                {{ gameStats()?.currentStreak || 0 }}
              </p>
              <p class="text-sm text-stone-700 dark:text-stone-300">
                {{ getStreakText(gameStats()?.currentStreak || 0) }}
              </p>
            </div>
          </div>

          <!-- 详细统计信息 -->
          <div class="mt-6 space-y-3">
            <div
              class="flex justify-between text-stone-700 dark:text-stone-300"
            >
              <span>{{ "myProfile.totalPlayTime" | translate }}</span>
              <span class="font-medium">{{
                formatTime(gameStats()?.totalPlayTime || 0)
              }}</span>
            </div>
            <div
              class="flex justify-between text-stone-700 dark:text-stone-300"
            >
              <span>{{ "myProfile.totalSteps" | translate }}</span>
              <span class="font-medium">{{
                gameStats()?.totalSteps || 0
              }}</span>
            </div>
            <div
              class="flex justify-between text-stone-700 dark:text-stone-300"
            >
              <span>{{ "myProfile.maxStreak" | translate }}</span>
              <span class="font-medium"
                >{{ gameStats()?.maxStreak || 0
                }}{{ "myProfile.days" | translate }}</span
              >
            </div>
          </div>
        </div>

        <!-- 历史记录区域 -->
        <div
          class="rounded-2xl border border-wood-border bg-wood-light p-6 shadow-lg dark:border-dark-wood-border dark:bg-dark-wood"
        >
          <div class="mb-4 flex items-center justify-between">
            <h2 class="text-xl font-bold text-wood-text dark:text-wood-lighter">
              {{ "myProfile.gameHistory" | translate }}
            </h2>
            <button
              *ngIf="gameHistory().length > 0"
              (click)="showClearHistoryConfirm()"
              appClickSound
              class="rounded-lg bg-red-500 px-3 py-1 text-sm font-medium text-white hover:bg-red-600"
            >
              {{ "myProfile.clearHistory" | translate }}
            </button>
          </div>

          <!-- 历史记录列表 -->
          <div *ngIf="gameHistory().length > 0" class="space-y-3">
            <div
              *ngFor="let record of gameHistory()"
              class="rounded-lg bg-wood-lighter p-4 transition-transform duration-200 hover:-translate-y-0.5 hover:shadow-lg dark:bg-dark-wood-light"
            >
              <!-- 移动端布局 -->
              <div class="block sm:hidden">
                <div class="">
                  <div class="mb-2 flex items-start justify-between">
                    <h3 class="font-medium text-stone-700 dark:text-stone-300">
                      {{ getLevelName(record) }}
                    </h3>
                    <p
                      class="text-sm font-medium"
                      [ngClass]="getRatingColor(record.rating)"
                    >
                      {{ getLocalizedRating(record.rating) }}
                    </p>
                  </div>
                  <div
                    class="space-y-1 text-xs text-stone-700 dark:text-stone-300"
                  >
                    <div class="flex justify-between">
                      <span
                        >{{ "myProfile.steps" | translate }}:
                        {{ record.steps }}</span
                      >
                      <span
                        >{{ "myProfile.time" | translate }}:
                        {{ formatTime(record.time) }}</span
                      >
                    </div>
                    <div class="flex justify-between">
                      <span>{{ getDifficultyText(record.difficulty) }}</span>
                      <span>{{ formatDate(record.completedAt) }}</span>
                    </div>
                  </div>
                </div>
                <div class="mt-3 flex justify-end">
                  <button
                    (click)="replay(record.id); $event.stopPropagation()"
                    class="rounded-lg bg-blue-500 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-600"
                  >
                    {{ "myProfile.replay" | translate }}
                  </button>
                </div>
              </div>

              <!-- 桌面端布局 -->
              <div class="hidden items-center justify-between sm:flex">
                <div class="flex-1">
                  <h3 class="font-medium text-stone-700 dark:text-stone-300">
                    {{ getLevelName(record) }}
                  </h3>
                  <div
                    class="mt-1 flex items-center space-x-4 text-sm text-stone-700 dark:text-stone-300"
                  >
                    <span
                      >{{ "myProfile.steps" | translate }}:
                      {{ record.steps }}</span
                    >
                    <span
                      >{{ "myProfile.time" | translate }}:
                      {{ formatTime(record.time) }}</span
                    >
                    <span>{{ getDifficultyText(record.difficulty) }}</span>
                  </div>
                </div>
                <div class="text-right">
                  <p
                    class="text-sm font-medium"
                    [ngClass]="getRatingColor(record.rating)"
                  >
                    {{ getLocalizedRating(record.rating) }}
                  </p>
                  <p class="text-xs text-stone-700 dark:text-stone-300">
                    {{ formatDate(record.completedAt) }}
                  </p>
                </div>
                <button
                  (click)="replay(record.id); $event.stopPropagation()"
                  class="ml-4 rounded-lg bg-blue-500 px-3 py-1 text-sm font-medium text-white transition-colors hover:bg-blue-600"
                >
                  {{ "myProfile.replay" | translate }}
                </button>
              </div>
            </div>
          </div>

          <!-- 无历史记录时的提示 -->
          <div
            *ngIf="gameHistory().length === 0"
            class="py-8 text-center text-stone-700 dark:text-stone-300"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="mx-auto mb-4 h-16 w-16 opacity-50"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <p>{{ "myProfile.noHistory" | translate }}</p>
          </div>
        </div>
      </div>
      </div>
    </main>
  </div>
</div>

<!-- 通用确认Modal组件 -->
<app-confirm-modal (onConfirm)="clearHistory()"></app-confirm-modal>
